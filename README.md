# Сервис для работы с балансом аккаунта
Многие видели такое задание, думаю моя реализация тоже может кому-то пригодится
<br/>Стек: java 11, spring boot 2, mockito 2

## Задание

1.Создать сервис со следующим интерфейсом:

```java
public interface AccountService
{
	/**
 	* Retrieves current balance or zero if addAmount() method was not called before for specified id
 	*
 	* @param id balance identifier
 	*/
	Long getAmount(Integer id);
	/**
 	* Increases balance or set if addAmount() method was called first time
 	*
 	* @param id balance identifier
 	* @param value positive or negative value, which must be added to current balance
 	*/
	void addAmount(Integer id, Long value);
}
```
Сервис будет работать в высоконагруженной отказоустойчивой системе.
<br/>Сервис должен кэшировать данные в памяти и сохранять данные в БД (Oracle, PostgreSQL, MySQL)
или бросать Exception'ы если выполнить операцию не удалось.
<br/>В качестве транспортного слоя можно выбрать любой из протоколов RMI, Hessian, HTTP


2.Создать тестового клиента

Тестовый клиент должен уметь запускать несколько конкурентных потоков на определённом подмножестве идентификаторов
- rCount - количество читателей вызывающих метод getAmount(id)
- wCount - количество читателей вызывающих метод addAmount(id,value)
- idList - список или доапазон ключей которые будут использоваться для тестирования
Эти параметры можно задавать через командную строчку или конфигурационный файл.
Одновременно можно запускать несколько тестовых клиентов на одном или разных компьютерах.

3.Получить стаистику обрабатки запросов на сервере AccountService'ом
Для каждого из двух методов AccountService'а (getAmount, addAmount) нужно получить
- кол-во запросов обрабатываемых в единицу времени на сервере (!!! не на клиенте)
- общее кол-во запросов от всех клентов
 
Статистику с сервиса можно получать по требованию любым способом
или сбрасывать в лог с определённой периодичностью.
Предусмотреть возможность сбросить статистику в ноль на работающем сервисе.

## Инструменты
Java 11: последняя рабочая версия
<br/>Spring: куда же без спринга? приложение стартует на раз два:)
<br/>Lombok: не надо писать геттеры/сеттеры/конструкторы и т.д., упрощает жизнь.
<br/>PostgreSQL: она настроена у меня, поэтому не вижу смысла использовать что-то другое в тестовом проекте.
<br/>Liquibase: автоматически создает таблицы и при изменение скрипта, говорит об этом.
<br/>JUnit: для тестов
<br/>Mockito: для моков в тестах

## Настройка бд
Перед запуском сервера следует выполнить настройку БД

```sql
CREATE database test_project;
CREATE USER test_project_user WITH encrypted password 'test_project_user';
ALTER USER test_project_user nosuperuser nocreaterole;
ALTER database test_project owner to test_project_user;
```
test_project - база
<br/>test_project_user - роль для базы test_project

<br/>База и пользователь указаны так же в *`resources/application.properties`* модуля Server.

<br/>Или можно поднять базу данных в докере, для этого выполните *`docker-compose pull`*, а затем  *`docker-compose up -d`* 

### Сборка jar файлов
В каждом модуле нужно выполнить `mvn clean install`


### Сервер

Для запуска клиента нужно выполнить слудующую команду <br/>`java -jar
D:\Projects\local\AccountBalance\server\target\server-0.0.1-SNAPSHOT.jar`
<br/>после -jar нужно указать путь до запускаемого файла

<br/>Сервер автоматически записывает статистику в файл(если она есть),
указанный в проперти в *`file.path`* <br/>Файл при очистки статистики не
очищается <br/>*Для сервера так же есть тесты в директории tests*

<br/>*Дополнительно с помощью плагина и аннтоций формируется
swagger.json в папке api(только после выполнения mvn clean install)*
<br/>Запись статистики в файл происходит каждые **1000 мс**. Если поставить
слишком маленькие данные на клиенте и в конце флаг очистки статистики,
то статистика может не успеть записаться в файл.(Тогда нужно увеличить
частоту записи в файл)

### Клиент

Для запуска клиента нужно выполнить слудующую команду
<br/>`java -jar -DconfigPath="D:\Projects\local\AccountBalance\client\src\main\resources\client.properties" D:\Projects\local\AccountBalance\client\target\client-0.0.1-SNAPSHOT.jar`
<br/>После -jar нужно указать путь до запускаемого файла
<br/>В *`-DconfigPath`* указывается абсолютный путь до настроек из вне(при их изменение достаточно перезапустить клиент и нет необходимости пересобирать jar файл)
<br/>Для запуска на одной машине достаточно изменить `server.port` в заданном файле, либо же указать его в *`-Dserver.port`* при запуске jar  
  
<br/>В самом файле конфигурации в *`file.path`* следует указать
абсолютный путь до файла с данными для запуска клиента   
<br/>Файл должен содержать:
- 1 строка - rCount - количество читателей вызывающих метод getAmount(id)
- 2 строка - wCount - количество читателей вызывающих метод addAmount(id,value)
- Далее каждая строка содержит элемент из idList - списка идентификаторов,
  которые будут использоваться для тестирования
- Если необходима очистка статистики, то последней строкой в файле
  должно быть true

**Очистка статистики будет выполнена после всех запросов, при этом файл
статистике очищен НЕ будет**
